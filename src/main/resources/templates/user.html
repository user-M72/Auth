<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>–ü—Ä–æ—Ñ–∏–ª—å</title>
</head>
<body>
<h1>–ü—Ä–∏–≤–µ—Ç, <span id="name">–ò–º—è</span>!</h1>
<p>Email: <span id="email">email@example.com</span></p>

<!-- Google -->
<p id="subField" style="display:none;">Google sub: <span id="sub"></span></p>

<!-- GitHub -->
<p id="idField" style="display:none;">GitHub ID: <span id="id"></span></p>
<p id="loginField" style="display:none;">GitHub Login: <span id="login"></span></p>

<img id="picture" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è" width="100" />
<br><br>

<!-- –∫–Ω–æ–ø–∫–∏ -->
<button onclick="goToChat()">üí¨ –ß–∞—Ç</button>
<button onclick="logout()">üö™ –í—ã–π—Ç–∏</button>

<script>
    const secretKey = 'jwtToken';

    // --- –ø–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL ---
    const urlParams = new URLSearchParams(window.location.search);
    const token   = urlParams.get('token');
    const name    = urlParams.get('name');
    const email   = urlParams.get('email');
    const sub     = urlParams.get('sub');       // Google
    const picture = urlParams.get('picture');   // Google
    const login   = urlParams.get('login');     // GitHub
    const id      = urlParams.get('id');        // GitHub
    const avatar  = urlParams.get('avatar');    // GitHub

    // --- —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω ---
    if (token) {
        localStorage.setItem(secretKey, token);
    }

    // --- –≤—ã–≤–æ–¥–∏–º –¥–∞–Ω–Ω—ã–µ ---
    if (name)  document.getElementById('name').textContent = name;
    if (email) document.getElementById('email').textContent = email;

    if (sub) {
        document.getElementById('subField').style.display = "block";
        document.getElementById('sub').textContent = sub;
    }

    if (id) {
        document.getElementById('idField').style.display = "block";
        document.getElementById('id').textContent = id;
    }

    if (login) {
        document.getElementById('loginField').style.display = "block";
        document.getElementById('login').textContent = login;
    }

    // --- –∞–≤–∞—Ç–∞—Ä Google –∏–ª–∏ GitHub ---
    if (picture) {
        document.getElementById('picture').src = decodeURIComponent(picture);
    } else if (avatar) {
        document.getElementById('picture').src = decodeURIComponent(avatar);
    }

    // --- –∫–Ω–æ–ø–∫–∞ —á–∞—Ç ---
    function goToChat() {
        window.location.href = '/chat';
    }

    // --- logout ---
    function logout() {
        localStorage.removeItem(secretKey);
        window.location.href = '/login';
    }
</script>
</body>
</html>
